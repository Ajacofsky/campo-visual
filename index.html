import streamlit as st
from PIL import Image, ImageDraw
import numpy as np

st.set_page_config(layout="wide")
st.title("‚öñÔ∏è Calibraci√≥n Manual - Rojo Intenso")

file = st.sidebar.file_uploader("1. Subir Informe", type=['jpg', 'png', 'jpeg'])

if file:
    # Abrimos la imagen de forma directa con PIL
    img = Image.open(file).convert("RGB")
    draw = ImageDraw.Draw(img)
    w, h = img.size

    # --- CONTROLES ---
    st.sidebar.header("üéØ Ajustes")
    cx = st.sidebar.slider("Centro X", 0, w, w // 2)
    cy = st.sidebar.slider("Centro Y", 0, h, h // 2)
    
    # Slider para la marca de 60 grados
    x60 = st.sidebar.slider("Alinear con Marca 60¬∞", cx, w, cx + (w // 4))
    
    # MATEM√ÅTICA PURA PARA EQUIDISTANCIA
    distancia_total = x60 - cx
    paso_10 = distancia_total / 6.0  # Dividimos por 6 para tener marcas de 10¬∞

    # --- DIBUJO DE ANILLOS ---
    # Dibujamos de 10¬∞ a 60¬∞ (6 anillos)
    for i in range(1, 7):
        radio = paso_10 * i
        
        # Definimos el √°rea del c√≠rculo (Bounding box)
        left = cx - radio
        top = cy - radio
        right = cx + radio
        bottom = cy + radio
        
        # DIBUJO ROJO INTENSO (RGB: 255, 0, 0)
        # Usamos un ancho de 5 para que sea imposible no verlo
        draw.ellipse([left, top, right, bottom], outline=(255, 0, 0), width=5)
        
        # Dibujar marcas de los ejes en cada anillo
        draw.line([cx - 10, cy + radio, cx + 10, cy + radio], fill=(255, 0, 0), width=2)

    # Ejes cartesianos centrales
    draw.line([cx, 0, cx, h], fill=(255, 0, 0), width=2) # Eje Vertical
    draw.line([0, cy, w, cy], fill=(255, 0, 0), width=2) # Eje Horizontal

    # --- MOSTRAR RESULTADO ---
    st.image(img, use_container_width=True)
    
    st.success(f"Unidad de 10 grados: {round(paso_10, 2)} p√≠xeles. Todos los anillos son equidistantes.")

else:
    st.info("Sub√≠ el informe para activar la grilla roja.")
